<!DOCTYPE html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }
        body {
            font-family:monospace;
            display:flex;
            flex-direction:column;
            min-height: 100vh;
            overflow:hidden;
            background-color: #fff; /* Add a background */
        }
        #header { flex-shrink:0; text-align:right; padding:12px; }
        #messages { flex:1; overflow:auto; min-height:0; padding:12px; font-size:16px; line-height:1.4; }
        #inputArea { flex-shrink:0; display:flex; align-items:center; gap:12px; padding:12px; }
        
        /* --- DEBUG STYLES FOR INPUT --- */
        #msgInput {
            flex:1;
            padding:12px 16px;
            font-size:16px; /* 16px is important to prevent zoom on focus */
            border-radius:6px;
            border: 1px solid #ccc; /* Explicit border */
            background-color: #fff; /* Explicit background */
            -webkit-appearance: none; /* Remove iOS styling */
            z-index: 10; /* Ensure it's on top */
        }
        /* --- END DEBUG STYLES --- */

        #send-controls { display: flex; align-items: center; gap: 8px; }
        #charCount { font-size:16px; user-select:none; }
        #sendBtn, #shareBtn { padding:12px 20px; font-size:16px; border-radius:6px; white-space:nowrap; cursor: pointer; }
        .msg { margin-bottom:6px; word-break:break-word; }
        {{.ResponsiveCSS}}
    </style>
</head>
<body>
<div id="header"><button id="shareBtn" onclick="shareLink()">Share Invite Link</button></div>
<div id="messages"></div>
<form id="inputForm" onsubmit="send(); return false;">
    <div id="inputArea">
        <!-- DEBUG: Removed autocomplete and enterkeyhint attributes -->
        <input id="msgInput" type="text" maxlength="160" placeholder="Type message...">
        <div id="send-controls"><span id="charCount">0/160</span><button id="sendBtn" type="submit">Send</button></div>
    </div>
</form>
<script>
const roomID = "{{.RoomID}}";

const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
const ws = new WebSocket(wsProtocol + '//' + location.host + '/ws?room=' + roomID);

const msgs = document.getElementById('messages');
const input = document.getElementById('msgInput');
const count = document.getElementById('charCount');

function addMessage(text) {
    const d = document.createElement('div');
    d.className = 'msg'; d.textContent = text;
    msgs.appendChild(d); msgs.scrollTop = msgs.scrollHeight;
}

ws.onmessage = e => addMessage(e.data);

function send(){
    if(input.value){
        ws.send(input.value);
        input.value=''; updateCount();
    }
}

function updateCount(){ count.textContent = input.value.length + '/160'; }

function shareLink(){
    const url = location.href;
    navigator.clipboard.writeText(url).then(() => alert('Link copied!'))
    .catch(() => prompt('Copy this link:', url));
}

input.addEventListener('input', updateCount);

// DEBUG: Removed the automatic focus call
// input.focus(); 
updateCount();
</script>
</body>
</html>