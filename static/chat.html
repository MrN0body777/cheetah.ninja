<!DOCTYPE html>
<body>
<div>
    <button onclick="shareLink()">Share Invite Link</button>
    <span id="linkStatus"></span>
</div>
<div id="msgs"></div>
<div>
    <input id="i" maxlength="160" onkeypress="if(event.key=='Enter')send()" placeholder="Type message...">
    <button onclick="send()">Send</button>
</div>
<script>
const roomID = location.pathname.substring(1);
const userID = Math.random().toString(36).substring(2, 15);
const ws = new WebSocket('ws://'+location.host+'/ws?room='+roomID);
const msgs = document.getElementById('msgs');
const i = document.getElementById('i');
const linkStatus = document.getElementById('linkStatus');

ws.onmessage = e => {
    const d = document.createElement('div');
    d.textContent = e.data;
    msgs.appendChild(d);
};

ws.onopen = () => {
    const d = document.createElement('div');
    d.textContent = 'Chat room created. Share the link to invite others.';
    d.style.color = 'gray';
    d.style.fontStyle = 'italic';
    msgs.appendChild(d);
};

function send(){
    if(i.value){
        ws.send(i.value);
        i.value='';
    }
}

function shareLink(){
    const url = location.href;
    navigator.clipboard.writeText(url).then(() => {
        linkStatus.textContent = 'Link copied!';
        setTimeout(() => linkStatus.textContent = '', 2000);
    }).catch(() => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = url;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        linkStatus.textContent = 'Link copied!';
        setTimeout(() => linkStatus.textContent = '', 2000);
    });
}

// Auto-focus input
i.focus();
</script>
</body>
</html>